# Solution structure

Солюшен - это контейнер, который состоит из проектов, которые в свою очередь состоят из файлов с кодом. Более подробно почитать можно тут - <https://docs.microsoft.com/en-us/visualstudio/ide/creating-solutions-and-projects?view=vs-2022>. Проекты используются для того, чтобы разделить большое сложное решение на несколько более простых и менее объемных. Чтобы они проект мог использовать код из другого проекта, добавляется зависимость на этот проект. Зависимости добавляются в рамках одного солюшена. Помимо зависимостей от проектов есть ещё зависимость от фреймворка и nuget-библиотек. Солюшен представлен как .sln файл, который содержит перечисление добавленных в него проектов

В солюшене помимо проектов можно ещё создавать директория. Это может понадобиться, когда в проекте появляется много проектов и их нужно сгруппировать. Например:

- директория для тестов, если таких несколько
- директория для проектов слоя представления (если в проекте поддерживается GUI, CUI и Web API)
- директория для инфраструктурных проектов, например проекты с логикой работы с базой
- директория для основных проектов, содержащих бизнес логику

Структура:

```text
NewSolutionName/
|   Tests/
|   |   NewSolutionName.Tests/
|   |   |   NewSolutionName.Tests.csproj
|   NewSolutionName.Project1/
|   |   NewSolutionName.Project1.csproj
|   NewSolutionName.sln
```

Проекты имеет более сложную метадату. В минимальном виде он состоит из версии dotnet'а, который используется, типа проекта и зависимостей (как от других проектов, так и от нюгетов). Виды проектов:

- Class library - проект для библиотек, дял кода, который не должен запускаться, а только использоваться в других проектах. Большинство проектов именно таковыми и являются
- NUnit/xUnit/MSTest - несколько видов проектов для тестов, которые используют разные инструменты для тестирования. NUnit из них самый распространённый.
- Console app - консольное приложение, которое использует консоль для взаимодействия с пользователем
- ASP.NET/Blazor/WPF - проекты для разработки приложений с использованием соответствующего фреймворка
- VSIX - проект для создания расширений для Visual Studio

## Нейминг солюшенов, папок, проектов и неймспейсов

Нейминг - это всегда сложности, но дальше будут рассмотрены общие паттерны, а не идеи для названий. Основное названием даётся солюшену. Оно обычно содержит идентифицирующие название, иногда компании названием. Например - `Kysect.Tamgly`. Если при создании нового солюшена выбрать не пустой солюшен, а какой-то проект, то будет создан по-умолчанию проект с таким же именем (но это можно менять в визарде создания). Это удобно для солюшенов с одним проектом (когда создаётся что-то для теста). Но хорошим тоном является создание проектов с более семантическим неймингом. Имя проекта должен содержать имя солюшена и только потом дополнение, которое описывает назначение проекта - `Kysect.Tamgly.Tests`, `Kysect.Tamgly.ConsoleClient`.

Названия проектов влияют на неймспейсы, который форсятся для созданных файлов. Так например, файл, который лежит в проекте Kysect.Tamgly.ConsoleClient в директории Core, будет иметь неймспейс Kysect.Tamgly.ConsoleClient.Core. С этим бывает две проблемы:

- При разработке сложного проекта появляется большое количество вложенных директорий, неймспейсы становятся длинными, а их количество быстро растёт. Становится очень не удобно работать с кодом, а его рефакторинг аффектит сразу большое количество файлов, если файл перенести в другую директорию.
- Если назвать директорию также, как и файл, то компилятор перестанет справляться с резолвом. Имея директорию Shop и класс Shop, у вас не будет больше возможности обратиться к классу напрямую т.к. произойдёт коллизия и нужно будет писать Shop.Shop (сначала указываем неймспейс, где лежит, а потом название класса)

## Как переименовать или переместить проект в солюшене

Важно отметить, что директории в солюшене не синхронизированы с директориями на файловой системе (как это происходит в проекте с файлами). Если в солюшене создать проект, а потом добавить директорию и переместить его туда, то он не переместиться на файловой системе. Аналогичная ситуация с переименованием. Если вы случайно создали проект с неправильным названием, а потом переименовали, то директория с проектом продолжит называться неправильно. К сожалению, нормально исправить такую ситуацию сложно:

1. В первую очередь, перед тем, как перемещать или переименовывать директорию с проектом, проще всего начать с удаления всех зависимостей других проектов на него и с него. Это связано с тем, что зависимости прописываются в csproj файле как относительные пути и сломаются после переноса. Если планируется только переименование, до зависимости можно оставить т.к. путь останется, но при переносе относительные пути сломаются.
2. Проект имеет смысл заэксклюдить из солюшена, закрыть солюшен и студию.
3. Не обязательно, но можно удалить папку .vs и файл *.suo
4. Найти директорию с проектом, сделать необходимые изменения
5. Открыть студию с солющеном, на нужной папке (или солюшене, если нужно в корень добавить) тыкнуть Add > Existing project..., выбрать нужный проект
6. Добавить нужные зависимости обратно

## Служебные директории bin и obj

- Добавление файла из солюшена в директорию bin

> TODO

## Nuget. Основная идея

В экосистеме dotnet существует пакетный менеджер Nuget. Пакетные менеджеры позволяют не хранить вместе с исходным кодом проекта все его библиотеки, а только указывать зависимость на них. При этом, библиотеки будут скачиваться при попытке восстановить и запустить проект, но сохраняться будут отдельно, смогут шариться между проектами. Nuget также отвечает за контролем версий пакетов, обновлением их до актуальной версии и нахождением проблем с их восстановлением.

> TODO

## Создание своих нюгетов

> TODO

## Dll hell

> TODO

## Sources

- <https://docs.microsoft.com/en-us/visualstudio/ide/creating-solutions-and-projects?view=vs-2022>